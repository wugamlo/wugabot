The SVG formatting issue could stem from a few key factors in your current implementation:

HTML Encoding Conflict:
In your appendMessage function, you're HTML-encoding content before displaying it, which would break SVG XML tags. Let's modify that handling:
javascript


Copy code

function appendMessage(content, role, returnElement = false) {
    // ... existing code ...
    if (typeof content === 'string') {
        // Only escape if NOT containing SVG/code blocks
        if (!content.startsWith('<img') && !content.includes('<svg') && !content.includes('```')) {
            content = content
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
        }
        // Preserve XML/SVG tags in code blocks
        content = content
            .replace(/&lt;(\/?(?:svg|path|rect|circle|g))&gt;/g, '<span class="xml-tag">&lt;\$1&gt;</span>')
            .replace(/\n/g, '<br>');
    }
    // ... rest of existing code ...
}
Code Block Detection:
Enhance your code block detection to better handle SVG content in the formatContent function:
javascript


Copy code

function formatContent(content) {
    // Improved code block detection with XML/SVG support
    const codeBlockRegex = /```(svg|xml)?\n?([\s\S]+?)\n```/g;
    
    return content.replace(codeBlockRegex, (match, lang, code) => {
        const trimmedCode = code.trim();
        const highlighted = Prism.highlight(
            trimmedCode,
            Prism.languages[lang === 'svg' ? 'xml' : lang] || Prism.languages.text,
            lang === 'svg' ? 'xml' : lang
        );
        return `<pre class="code-block"><code class="language-${lang || 'text'}">${highlighted}</code></pre>`;
    });
}
CSS Adjustments:
Add specific SVG styling rules to ensure proper display:
css


Copy code

/* Add to style.css */
.message pre code .xml-tag {
    color: #ff9966; /* SVG/XML tag color */
}

.message pre code .xml-attr {
    color: #9cdcfe; /* Attribute name color */
}

.message pre code .xml-str {
    color: #ce9178; /* Attribute value color */
}

.reasoning-content pre {
    background: var(--code-bg) !important;
    padding: 15px !important;
    border-radius: 8px !important;
}
Prism Language Support:
Ensure you're loading Prism's XML/HTML support for proper SVG syntax highlighting. Add this to your HTML head:
html


Copy code

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-xml-doc.min.js"></script>
To use this correctly, users should format SVG content in triple backticks with the SVG language specifier:


Copy code

Here's an SVG example:
```svg
<svg width="100" height="100">
  <circle cx="50" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" ></circle>
</svg>
```
These changes should properly preserve and format SVG content in both regular messages and reasoning blocks while maintaining security through selective HTML encoding. The SVG code will be displayed with syntax highlighting while keeping the actual vector graphic rendering disabled for security reasons.