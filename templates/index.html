<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#121212">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/static/WugaBot_png420.png">
    <title>WugaBot</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
</head>
    <body>
        <div class="header">
            <div class="header-left">
                <button id="settingsToggle" class="icon-button">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="header-title">WugaBot</div>
            </div>
            <div class="header-center">
                <select id="headerModelSelect" class="model-select"></select>
                <button id="modelInfoButton" class="icon-button" onclick="toggleModelInfoPopup()">
                    <i class="fas fa-info-circle"></i>
                </button>
            </div>
            <div class="header-right">
                <button id="headerClearChat" class="icon-button" onclick="clearChatHistory()">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
        <div class="container">
            <div class="settings-panel">
                <div class="settings-panel-header">
                    <h2>Settings</h2>
                    <div class="settings-buttons">
                        <button onclick="clearChatHistory()">Clear Chat</button>
                    </div>
                </div>
                <div class="settings-content">
                    <div class="settings-fields">
                        <div class="field-group">
                            <label for="modelSelect">Model</label>
                            <select id="modelSelect"></select>
                        </div>
                        <div class="field-group">
                            <label for="characterSelect">Character</label>
                            <select id="characterSelect"></select>
                        </div>
                        <div class="field-group">
                            <label for="textSize">Text Size</label>
                            <select id="textSize" onchange="toggleTextSize(this.value)">
                                <option value="small">Small</option>
                                <option value="big">Big</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label for="maxTokens">Max Completion Tokens</label>
                            <input type="number" id="maxTokens" min="100" max="8000" step="100" value="4000">
                        </div>
                        <div class="field-group">
                            <label for="temperature">Temperature</label>
                            <div class="slider-container">
                                <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7">
                                <span id="temperatureValue">0.7</span>
                            </div>
                        </div>
                        <div class="field-group">
                            <label for="ragEnabled">Enable Retrieval-Augmented Generation (RAG)</label>
                            <div class="toggle-switch-container">
                                <input type="checkbox" id="ragEnabled" class="toggle-switch">
                                <label for="ragEnabled" class="toggle-label"></label>
                            </div>
                        </div>
                        <div class="field-group" id="knowledgeBaseContainer" style="display: none;">
                            <label for="knowledgeBase">Knowledge Base</label>
                            <select id="knowledgeBase"></select>
                        </div>
                        
                        <div class="field-group">
                            <label for="systemPrompt">System Prompt</label>
                            <textarea id="systemPrompt" placeholder="Enter system prompt..." wrap="soft">You are WugaBot, a knowledgeable and helpful assistant. Your goal is to provide accurate, informative, and engaging responses to the user's questions and requests. You are able to understand the context and nuances of the user's query and respond accordingly. You are not limited to providing factual information, but can also offer suggestions, advice, and guidance where relevant. Your tone is friendly, approachable, and non-judgmental. You are able to handle a wide range of topics and questions, from science and history to entertainment and culture. You are a trusted companion and advisor, and your responses reflect that. You reply in English language.</textarea>
                            <button onclick="saveSettings()">Save Settings</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="chat-box" id="chatBox"></div>
            <div class="input-area">
                <input type="file" id="galleryInput" accept="image/*" style="display: none;">
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;">
                <input type="file" id="fileInput" accept=".txt,.pdf,.doc,.docx,.xls,.xlsx" style="display: none;">

                <div class="input-row">
                    <div class="attachment-menu-container">
                        <button id="attachmentButton" class="icon-button" onclick="toggleAttachmentMenu()" title="Attachments">
                            <i class="fas fa-plus"></i>
                        </button>
                        <div id="attachmentMenu" class="attachment-menu hidden">
                            <button class="attachment-option" onclick="document.getElementById('galleryInput').click(); toggleAttachmentMenu();">
                                <i class="fas fa-fw fa-camera"></i>
                                <span>Upload Image</span>
                            </button>
                            <button class="attachment-option" onclick="document.getElementById('fileInput').click(); toggleAttachmentMenu();">
                                <i class="fas fa-fw fa-file"></i>
                                <span>Upload File</span>
                            </button>
                            <button class="attachment-option" onclick="toggleImageGenPanel(); toggleAttachmentMenu();">
                                <i class="fas fa-fw fa-magic"></i>
                                <span>Generate Image</span>
                            </button>
                        </div>
                    </div>
                    <textarea id="userInput" placeholder="Type your message..." rows="1"></textarea>
                    <button id="sendButton" onclick="startStream()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="toggle-bar">
                    <button id="searchEnabled" class="toggle-pill" onclick="toggleWebSearch(this)" title="Web Search">
                        <i class="fas fa-globe"></i>
                        <span>Search</span>
                    </button>
                    <button id="deepResearchButton" class="toggle-pill" onclick="toggleDeepResearchPanel()" title="Deep Research">
                        <i class="fas fa-brain"></i>
                        <span>Research</span>
                    </button>
                    <button id="composerButton" class="toggle-pill" onclick="togglePromptComposer()" title="Prompt Composer">
                        <i class="fas fa-pen-fancy"></i>
                        <span>Compose</span>
                    </button>
                </div>
                <div id="imagePreview"></div>
            </div>

            <div class="prompt-composer">
                <div class="prompt-composer-header">
                    <h2>Prompt Composer</h2>
                    <div class="composer-buttons">
                        <button class="icon-button" onclick="clearFields()">
                            <i class="fas fa-trash"></i>
                        </button>
                        <button class="icon-button" onclick="transferPrompt()">
                            <i class="fas fa-arrow-right"></i>
                        </button>
                        <button class="icon-button" onclick="togglePromptComposer()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="composer-content">
                    <div class="composer-fields">
                        <div class="field-group">
                            <label for="instructions">Instructions</label>
                            <textarea id="instructions" placeholder="Enter main instructions..."></textarea>
                        </div>
                        <div class="field-group">
                            <label for="format">Return Format</label>
                            <textarea id="format" placeholder="Specify return format..."></textarea>
                        </div>
                        <div class="field-group">
                            <label for="context">Context</label>
                            <textarea id="context" placeholder="Add additional context..."></textarea>
                        </div>
                        <div class="field-group">
                            <label for="examples">Examples</label>
                            <textarea id="examples" placeholder="Provide examples..."></textarea>
                        </div>
                        <div class="field-group">
                            <label for="warnings">Warnings</label>
                            <textarea id="warnings" placeholder="Add warnings..."></textarea>
                        </div>
                    </div>
                    
                    <!-- Debug Tools Section -->
                    <div class="debug-tools">
                        <h3>Debug Tools</h3>
                        <div class="debug-buttons">
                            <button onclick="showChatContext()" class="debug-button">
                                <i class="fas fa-bug"></i> Show Chat Context
                            </button>
                            <button onclick="displayFullChatHistory()" class="debug-button">
                                <i class="fas fa-history"></i> Show Full Chat History
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="deep-research-panel">
                <div class="deep-research-panel-header">
                    <h2>Deep Research Mode</h2>
                    <div class="panel-buttons">
                        <button class="icon-button" onclick="toggleDeepResearchPanel()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="deep-research-content">
                    <div class="deep-research-fields">
                        <div class="field-group">
                            <label for="expertModeEnabled">Enable Deep Research Mode</label>
                            <div class="toggle-switch-container">
                                <input type="checkbox" id="expertModeEnabled" class="toggle-switch">
                                <label for="expertModeEnabled" class="toggle-label"></label>
                            </div>
                        </div>
                        <div class="expert-mode-controls" id="expertModeContainer" style="display: none;">
                            <div class="field-group">
                                <label>Select Candidate Models</label>
                                <div class="model-checkboxes" id="candidateModels">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                            <div class="field-group">
                                <label for="synthesisModel">Synthesis Model</label>
                                <select id="synthesisModel">
                                    <!-- Populated by JavaScript -->
                                </select>
                            </div>
                            <div class="field-group">
                                <label for="showCandidates">Show Individual Responses (Debug)</label>
                                <div class="toggle-switch-container">
                                    <input type="checkbox" id="showCandidates" class="toggle-switch">
                                    <label for="showCandidates" class="toggle-label"></label>
                                </div>
                            </div>
                        </div>
                        <div class="field-group">
                            <p class="help-text">
                                Deep Research Mode queries multiple AI models simultaneously and synthesizes their responses for more comprehensive answers.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="image-gen-panel hidden">
                <div class="image-gen-panel-header">
                    <h2>Image Generation</h2>
                    <div class="panel-buttons">
                        <button class="icon-button" onclick="toggleImageGenPanel()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="image-gen-content">
                    <div class="image-gen-fields">
                        <div class="field-group">
                            <label for="imageModel">Image Model</label>
                            <select id="imageModel">
                                <option value="">Loading models...</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label for="imageStyle">Style (Optional)</label>
                            <select id="imageStyle">
                                <option value="">No style</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label for="imageFormat">Format</label>
                            <select id="imageFormat">
                                <option value="webp">WebP (Recommended)</option>
                                <option value="png">PNG (High Quality)</option>
                                <option value="jpeg">JPEG</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label for="imageSize">Size</label>
                            <select id="imageSize">
                                <option value="1024x1024">1024x1024 (Square)</option>
                                <option value="1280x720">1280x720 (Landscape)</option>
                                <option value="720x1280">720x1280 (Portrait)</option>
                                <option value="512x512">512x512 (Small)</option>
                            </select>
                        </div>
                        <div class="field-group">
                            <label for="imagePrompt">Image Prompt</label>
                            <textarea id="imagePrompt" placeholder="Describe the image you want to generate..."></textarea>
                        </div>
                        <div class="field-group">
                            <label for="negativePrompt">Negative Prompt (Optional)</label>
                            <textarea id="negativePrompt" placeholder="What to avoid in the image..."></textarea>
                        </div>
                        <div class="field-group">
                            <button onclick="generateImage()" class="generate-image-btn">
                                <i class="fas fa-magic"></i> Generate Image
                            </button>
                        </div>
                        <div class="field-group">
                            <p class="help-text">
                                Image generation typically takes 10-30 seconds. Generated images will appear in the chat.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="loading" class="loading hidden"></div>
                <div class="loading-dots"></div>
            </div>
            
            <!-- Model Info Popup -->
            <div id="modelInfoPopup" class="model-info-popup hidden">
                <div class="model-info-content">
                    <div class="model-info-header">
                        <h2>Model Information</h2>
                        <button class="icon-button" onclick="toggleModelInfoPopup()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="model-info-table-container">
                        <table id="modelInfoTable" class="model-info-table">
                            <thead>
                                <tr>
                                    <th class="model-name-header">Model</th>
                                    <th class="context-header">Context</th>
                                    <th class="capability-header" title="Reasoning"><i class="fas fa-brain"></i></th>
                                    <th class="capability-header" title="Vision"><i class="fas fa-eye"></i></th>
                                    <th class="capability-header" title="Web Search"><i class="fas fa-globe"></i></th>
                                    <th class="capability-header" title="Code"><i class="fas fa-code"></i></th>
                                    <th class="capability-header" title="Functions"><i class="fas fa-cogs"></i></th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> <!-- Font Awesome for icons -->
        <script src="/static/script.js" type="module"></script>
    </body>
</html>